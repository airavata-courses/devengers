package com.devengers.service.sessionmanagement.rabbitmq;

import java.util.List;

import org.json.JSONObject;
import org.springframework.amqp.core.Message;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.data.domain.Example;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.data.jpa.repository.config.EnableJpaRepositories;
import org.springframework.stereotype.Component;
import org.springframework.amqp.core.MessageListener;

import com.devengers.service.sessionmangement.controller.SessionServiceResource;
import com.devengers.service.sessionmangement.model.UserSessionDetail;
import com.devengers.service.sessionmangement.repository.SessionDetailsRepository;

@EnableJpaRepositories(basePackages = "com.devengers.service.sessionmanagement.repository")
public class Consumer implements MessageListener {
	String str = "";

	SessionDetailsRepository quotesRepository = new SessionDetailsRepository() {
		
		@Override
		public <S extends UserSessionDetail> S findOne(Example<S> example) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public <S extends UserSessionDetail> Page<S> findAll(Example<S> example, Pageable pageable) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public <S extends UserSessionDetail> boolean exists(Example<S> example) {
			// TODO Auto-generated method stub
			return false;
		}
		
		@Override
		public <S extends UserSessionDetail> long count(Example<S> example) {
			// TODO Auto-generated method stub
			return 0;
		}
		
		@Override
		public <S extends UserSessionDetail> S save(S entity) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public UserSessionDetail findOne(Integer id) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public boolean exists(Integer id) {
			// TODO Auto-generated method stub
			return false;
		}
		
		@Override
		public void deleteAll() {
			// TODO Auto-generated method stub
			
		}
		
		@Override
		public void delete(Iterable<? extends UserSessionDetail> entities) {
			// TODO Auto-generated method stub
			
		}
		
		@Override
		public void delete(UserSessionDetail entity) {
			// TODO Auto-generated method stub
			
		}
		
		@Override
		public void delete(Integer id) {
			// TODO Auto-generated method stub
			
		}
		
		@Override
		public long count() {
			// TODO Auto-generated method stub
			return 0;
		}
		
		@Override
		public Page<UserSessionDetail> findAll(Pageable pageable) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public <S extends UserSessionDetail> S saveAndFlush(S entity) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public <S extends UserSessionDetail> List<S> save(Iterable<S> entities) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public UserSessionDetail getOne(Integer id) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public void flush() {
			// TODO Auto-generated method stub
			
		}
		
		@Override
		public <S extends UserSessionDetail> List<S> findAll(Example<S> example, Sort sort) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public <S extends UserSessionDetail> List<S> findAll(Example<S> example) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public List<UserSessionDetail> findAll(Iterable<Integer> ids) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public List<UserSessionDetail> findAll(Sort sort) {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public List<UserSessionDetail> findAll() {
			// TODO Auto-generated method stub
			return null;
		}
		
		@Override
		public void deleteInBatch(Iterable<UserSessionDetail> entities) {
			// TODO Auto-generated method stub
			
		}
		
		@Override
		public void deleteAllInBatch() {
			// TODO Auto-generated method stub
			
		}
		
		@Override
		public List<UserSessionDetail> findByUserName(int i) {
			// TODO Auto-generated method stub
			return null;
		}
	};

	@Override
	public void onMessage(Message message) {

		System.out.println(new String(message.getBody()));
		byte[] body = message.getBody();
		if (body != null) {
			str = new String(body);
			JSONObject json = new JSONObject(str);
			System.out.println(json.toString());
			int user = (int) json.get("userid");
			int correl = (int) json.get("correlationid");
			int files = (int) json.get("no_of_files");
			System.out.println("userid is: " + user);
			System.out.println("correl is :" + correl);

			System.out.println("files is :" + files);

			UserSessionDetail usersessiondetail = new UserSessionDetail();
			usersessiondetail.setUserId(user);
			usersessiondetail.setCorrelationId(correl);
			usersessiondetail.setNo_of_files(files);
			System.out.println("**********" + usersessiondetail);
			if (usersessiondetail != null) {
				int temp = usersessiondetail.getUserId();
				System.out.println("GETUUSEERIIDD"+temp);
				quotesRepository.save(usersessiondetail);
			}
			// ssr.details(usersessiondetail);

			System.out.println("Do we reach here ");
		}
	}

}
